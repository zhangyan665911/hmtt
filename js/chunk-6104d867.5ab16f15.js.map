{"version":3,"sources":["webpack:///./src/views/user/profile.vue?4970","webpack:///src/views/user/profile.vue","webpack:///./src/views/user/profile.vue?4b70","webpack:///./src/views/user/profile.vue","webpack:///./node_modules/core-js/modules/es.function.name.js","webpack:///./src/api/user.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","on","$event","$router","back","saveUserProfile","user","photo","openImagePopup","name","openName","gender","openGender","birthday","openBirthday","staticStyle","model","value","callback","$$v","showImage","expression","selectFromLocal","showName","errorNameMsg","$set","trim","closeName","_v","actions","changeGender","showGender","showBirthday","minDate","maxDate","confirmBirthday","currentDate","ref","getFile","staticRenderFns","data","Date","created","getUserProfile","methods","$refs","file","click","length","item","component","DESCRIPTORS","defineProperty","f","FunctionPrototype","Function","prototype","FunctionPrototypeToString","toString","nameRE","NAME","configurable","get","call","match","error","login","request","url","method","followUser","target","unfollowUser","getUserInfo","updateUserImage","getUser","updateUser"],"mappings":"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","file":"js/chunk-6104d867.5ab16f15.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('van-nav-bar',{attrs:{\"title\":\"编辑信息\",\"left-arrow\":\"\",\"right-text\":\"保存\"},on:{\"click-left\":function($event){return _vm.$router.back()},\"click-right\":_vm.saveUserProfile}}),_c('van-cell-group',[_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"头像\",\"center\":\"\"}},[_c('van-image',{attrs:{\"round\":\"\",\"width\":\"1.5rem\",\"height\":\"1.5rem\",\"src\":_vm.user.photo,\"fit\":\"cover\"},on:{\"click\":_vm.openImagePopup}})],1),_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"名称\",\"value\":_vm.user.name},on:{\"click\":_vm.openName}}),_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"性别\",\"value\":_vm.user.gender == 0 ?'男':'女'},on:{\"click\":_vm.openGender}}),_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"生日\",\"value\":_vm.user.birthday},on:{\"click\":_vm.openBirthday}})],1),_c('van-popup',{staticStyle:{\"width\":\"80%\"},model:{value:(_vm.showImage),callback:function ($$v) {_vm.showImage=$$v},expression:\"showImage\"}},[_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"本地相册选择图片\"},on:{\"click\":_vm.selectFromLocal}}),_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"拍照\"}})],1),_c('van-popup',{staticStyle:{\"width\":\"80%\"},attrs:{\"close-on-click-overlay\":false},model:{value:(_vm.showName),callback:function ($$v) {_vm.showName=$$v},expression:\"showName\"}},[_c('van-field',{attrs:{\"error-message\":_vm.errorNameMsg,\"type\":\"textarea\",\"placeholder\":\"请输入用户名\"},model:{value:(_vm.user.name),callback:function ($$v) {_vm.$set(_vm.user, \"name\", (typeof $$v === 'string'? $$v.trim(): $$v))},expression:\"user.name\"}}),_c('van-button',{attrs:{\"type\":\"info\",\"size\":\"large\"},on:{\"click\":_vm.closeName}},[_vm._v(\" 确定\")])],1),_c('van-action-sheet',{attrs:{\"actions\":_vm.actions,\"cancel-text\":\"取消\"},on:{\"select\":_vm.changeGender},model:{value:(_vm.showGender),callback:function ($$v) {_vm.showGender=$$v},expression:\"showGender\"}}),_c('van-popup',{attrs:{\"position\":\"bottom\"},model:{value:(_vm.showBirthday),callback:function ($$v) {_vm.showBirthday=$$v},expression:\"showBirthday\"}},[_c('van-datetime-picker',{attrs:{\"type\":\"date\",\"min-date\":_vm.minDate,\"max-date\":_vm.maxDate},on:{\"confirm\":_vm.confirmBirthday},model:{value:(_vm.currentDate),callback:function ($$v) {_vm.currentDate=$$v},expression:\"currentDate\"}})],1),_c('input',{ref:\"file\",staticStyle:{\"display\":\"none\"},attrs:{\"type\":\"file\"},on:{\"change\":_vm.getFile}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n      <van-nav-bar title=\"编辑信息\" left-arrow @click-left=\"$router.back()\" right-text=\"保存\" @click-right=\"saveUserProfile\"></van-nav-bar>\r\n      <van-cell-group>\r\n        <van-cell is-link title=\"头像\" center>\r\n          <van-image\r\n              round\r\n              width=\"1.5rem\"\r\n              height=\"1.5rem\"\r\n              :src=\"user.photo\"\r\n              fit=\"cover\"\r\n              @click=\"openImagePopup\"\r\n          />\r\n        </van-cell>\r\n        <van-cell is-link title=\"名称\" :value=\"user.name\" @click=\"openName\"></van-cell>\r\n        <van-cell is-link title=\"性别\" :value=\"user.gender == 0 ?'男':'女'\" @click=\"openGender\"></van-cell>\r\n        <van-cell is-link title=\"生日\" :value=\"user.birthday\" @click=\"openBirthday\"></van-cell>\r\n      </van-cell-group>\r\n      <!-- 头像的弹出层 -->\r\n      <van-popup v-model=\"showImage\" style=\"width:80%\">\r\n        <van-cell is-link title=\"本地相册选择图片\" @click=\"selectFromLocal\"></van-cell>\r\n        <van-cell is-link title=\"拍照\"></van-cell>\r\n      </van-popup>\r\n      <van-popup v-model=\"showName\" style=\"width:80%\" :close-on-click-overlay=\"false\">\r\n        <van-field :error-message=\"errorNameMsg\" type=\"textarea\" v-model.trim=\"user.name\" placeholder=\"请输入用户名\" />\r\n        <van-button type=\"info\"  size=\"large\" @click=\"closeName\"> 确定</van-button>\r\n      </van-popup>\r\n      <van-action-sheet @select=\"changeGender\" v-model=\"showGender\"  :actions=\"actions\" cancel-text=\"取消\"/>\r\n      <van-popup v-model=\"showBirthday\" position=\"bottom\">\r\n        <van-datetime-picker\r\n          v-model=\"currentDate\"\r\n          type=\"date\"\r\n          :min-date=\"minDate\"\r\n          :max-date=\"maxDate\"\r\n          @confirm=\"confirmBirthday\"\r\n        />\r\n      </van-popup>\r\n      <input ref=\"file\" type=\"file\" style=\"display:none\" @change=\"getFile\">\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport dayjs from 'dayjs'\r\nimport { updateUserImage, getUser, updateUser } from '@/api/user'\r\nimport { mapMutations } from 'vuex'\r\nexport default {\r\n  data () {\r\n    return {\r\n      showImage: false,\r\n      showName: false,\r\n      showGender: false,\r\n      showBirthday: false,\r\n      user: {\r\n        name: '',\r\n        gender: 0,\r\n        birthday: ''\r\n      },\r\n      errorNameMsg: '',\r\n      actions: [\r\n        { name: '男' },\r\n        { name: '女' }\r\n      ],\r\n      minDate: new Date(1900, 1, 1),\r\n      maxDate: new Date(),\r\n      currentDate: new Date()\r\n    }\r\n  },\r\n  created () {\r\n    this.getUserProfile()\r\n  },\r\n  methods: {\r\n    ...mapMutations(['updatePhoto']),\r\n    async getUserProfile () {\r\n      let data = await getUser()\r\n      this.user = data\r\n    },\r\n    openImagePopup () {\r\n      this.showImage = true\r\n    },\r\n    selectFromLocal () {\r\n      this.$refs.file.click()\r\n    },\r\n    async getFile () {\r\n      var fd = new FormData()\r\n      fd.append('photo', this.$refs.file.files[0])\r\n      let result = await updateUserImage(fd)\r\n      // console.log(result)\r\n      this.user.photo = result.photo\r\n      // 这个地方需要存到vuex中\r\n      this.updatePhoto({ photo: this.user.photo })\r\n      this.showImage = false\r\n    },\r\n    openName () {\r\n      this.showName = true\r\n    },\r\n    closeName () {\r\n      if (this.user.name.length < 1 || this.user.name.length > 7) {\r\n        // 说明长度不合适\r\n        this.errorNameMsg = '用户名的长度必须是1-7位'\r\n        return false\r\n      }\r\n      this.errorNameMsg = ''\r\n      this.showName = false\r\n    },\r\n    openGender () {\r\n      this.showGender = true\r\n    },\r\n    changeGender (item, index) {\r\n      if (item.name === '男') {\r\n        // 说明点击的是男\r\n        this.user.gender = 0\r\n      } else {\r\n        this.user.gender = 1\r\n      }\r\n      // 设置完成以后关闭actionsheet\r\n      this.showGender = false\r\n    },\r\n    openBirthday () {\r\n      this.currentDate = new Date(this.user.birthday)\r\n      this.showBirthday = true\r\n    },\r\n    confirmBirthday (value) {\r\n      // console.log(value)\r\n      this.user.birthday = dayjs(value).format('YYYY-MM-DD')\r\n      this.showBirthday = false\r\n    },\r\n    async saveUserProfile () {\r\n      try {\r\n        await updateUser({\r\n          ...this.user, photo: null\r\n        })\r\n        this.$gnotify({\r\n          type: 'success',\r\n          message: '修改用户信息成功'\r\n        })\r\n      } catch (error) {\r\n        this.$gnotify({\r\n          type: 'danger',\r\n          message: '保存失败'\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./profile.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./profile.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./profile.vue?vue&type=template&id=5d08351c&scoped=true&\"\nimport script from \"./profile.vue?vue&type=script&lang=js&\"\nexport * from \"./profile.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5d08351c\",\n  null\n  \n)\n\nexport default component.exports","var DESCRIPTORS = require('../internals/descriptors');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.github.io/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !(NAME in FunctionPrototype)) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n","import request from '@/utils/request'\r\nexport function login (data) {\r\n  return request({\r\n    url: 'authorizations',\r\n    method: 'post',\r\n    data\r\n  })\r\n}\r\n// 关注用户\r\nexport function followUser (data) {\r\n  return request({\r\n    url: '/user/followings',\r\n    method: 'post',\r\n    data: {\r\n      target: data\r\n    }\r\n  })\r\n}\r\n// 取消关注用户\r\nexport function unfollowUser (target) {\r\n  return request({\r\n    url: `user/followings/${target}`,\r\n    method: 'delete'\r\n  })\r\n}\r\n// 获取用户自己的信息\r\nexport function getUserInfo () {\r\n  return request({\r\n    url: '/user'\r\n  })\r\n}\r\n// 编辑用户照片资料\r\nexport function updateUserImage (data) {\r\n  return request({\r\n    url: '/user/photo',\r\n    method: 'patch',\r\n    data\r\n  })\r\n}\r\n// 获取用户的基本信息\r\nexport function getUser () {\r\n  return request({\r\n    url: '/user/profile',\r\n    method: 'get'\r\n  })\r\n}\r\n// 编辑用户的基本信息\r\nexport function updateUser (data) {\r\n  return request({\r\n    url: '/user/profile',\r\n    method: 'patch',\r\n    data\r\n  })\r\n}\r\n"],"sourceRoot":""}